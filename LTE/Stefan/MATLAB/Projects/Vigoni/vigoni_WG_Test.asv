% This script tries to find inner resonances of an impedance formulation

close all;
clear;

set(0,'DefaultFigureWindowStyle','docked');

lteFileName = 'C:\work\examples\Vigoni_WG\sParam_epsSweep.txt';
[f S] = readSparamWaveSolver2(lteFileName);

%%
order = 8;
fontsize = 12;
linewidth = 1.0;
modelName = 'C:\work\examples\Vigoni_WG\Vigoni_WG_1.1e+010_EPSILON_RELATIVE_Cylinder1_(1,0)_10\';

impedanceFlag = false;
linFreqParamFlag = false;

buildRedModelInterpTransp(modelName, order, linFreqParamFlag);
fNameSpara = modelEvaluation(modelName, impedanceFlag);
% fNameSpara = [modelName 'S_f_1000000000_4500000000_101_MU_RELATIVE_74_1_7_101.txt'];

[parameterNames, numParameterPnts, parameterVals, sMatrices] ...
  = loadSmatrix(fNameSpara);


%% plot results
figHandle = figure;
set(figHandle,'color','w');

% one parameter plot
sVal = zeros(numParameterPnts(2),1);
eps = zeros(numParameterPnts(2),1);
for k = 1:numParameterPnts(2)
  eps(k) = parameterVals(2,k);
  sVal(k) = sMatrices{k}(1, 1);
end
plot(eps, abs(sVal));

% % two parameter plot
% pos = 1;
% nonOnePos = find(numParameterPnts(2:end) ~= 1) + 1;
% freqs = zeros(numParameterPnts(1),1);
% matVals = zeros(numParameterPnts(2),1);
% sVal = zeros(numParameterPnts(nonOnePos),numParameterPnts(1));
% for fCnt = 1:numParameterPnts(1)
%   for pCnt = 1:numParameterPnts(nonOnePos)
%     freqs(fCnt) = parameterVals(1,pos);
%     matVals(pCnt) = parameterVals(2,pos);
%     sVal(pCnt, fCnt) = sMatrices{pos}(1, 1);
%     pos = pos + 1;
%   end
% end
% surf(freqs*1e-9, matVals, abs(sVal));
% AZ = -1.4250e+002;
% EL = 40;
% view(AZ, EL);
% xlabel('Frequency (GHz)', 'FontSize', fontsize);
% ylabel('\mu_{r}', 'FontSize', fontsize);
% zlabel('|S_{11}|', 'FontSize', fontsize);
% %axis([1 4.5 1 7 0 0.6]);
% %title('\epsilon_{r2} = 8', 'FontSize', fontsize);
% set(gca,'FontSize',fontsize);
% title('', 'FontSize', fontsize);



